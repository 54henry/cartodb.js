<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>CartoDB.js load example</title>
    <meta name=viewport content="width=device-width initial-scale=1">
    <link rel="stylesheet" href="/dist/themes/css/cartodb.css" />
    <script src="/dist/cartodb.uncompressed.js"></script>
    <script src="/dist/cartodb.mod.torque.uncompressed.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700' rel='stylesheet' type='text/css'>

    <style type="text/css">
      html, body {
        position:relative;
        height: 100%;
        padding: 0;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div id="dashboard"></div>

    <script>
      window.onload = function() {
          var vizJSON2 = {
            "id": "84ec6844-4b4b-11e5-9c1d-080027880ca6",
            "user": {
              "fullname": "Emilio García",
              "avatar_url": "https://s3.amazonaws.com/com.cartodb.users-assets.production/production/piensaenpixel/assets/20150507074635Captura%20de%20pantalla%202015-05-07%20a%20la%28s%29%2009.46.28.png"
            },
            "version": "0.1.0",
            "title": "Mapaza",
            "likes": 0,
            "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Maecenas rutrum porttitor sollicitudin. Morbi vitae felis dignissim, lacinia justo id, ornare augue. Maecenas sed elit enim. Etiam auctor lacus lorem, sed tempor ante feugiat eu. Duis rhoncus luctus egestas. Curabitur iaculis pellentesque pulvinar. Curabitur eros nisi, lobortis volutpat ultrices faucibus, laoreet ut enim.",
            "scrollwheel": false,
            "legends": true,
            "url": null,
            "map_provider": "leaflet",
            "bounds": [
              [
                41.33815377536821,
                2.013759613037109
              ],
              [
                41.46086777862755,
                2.3272132873535156
              ]
            ],
            "center": "[41.39950754886423, 2.170400619506836]",
            "zoom": 13,
            "updated_at": "2015-10-26T11:50:30+00:00",
            "layers": [
              {
                "options": {
                  "visible": true,
                  "type": "Tiled",
                  "name": "Positron",
                  "className": "httpsbasemapscartocdncomlight_nolabelszxypng",
                  "base_type": "default",
                  "urlTemplate": "http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",
                  "minZoom": "0",
                  "maxZoom": "18",
                  "attribution": "© <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors © <a href= \"http://cartodb.com/attributions#basemaps\">CartoDB</a>",
                  "subdomains": "abcd",
                  "style": null,
                  "labels": {
                    "url": "http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png"
                  },
                  "read_only": true,
                  "category": "CartoDB",
                  "order": 0,
                  "id": "a4b5985f-5757-4ff3-8957-01e41247318c",
                  "parent_id": null
                },
                "infowindow": null,
                "tooltip": null,
                "id": "a4b5985f-5757-4ff3-8957-01e41247318c",
                "order": 0,
                "type": "tiled"
              },
              {
                "type": "namedmap",
                "order": 1,
                "options": {
                  "named_map": {
                    "template_name": "tpl_ece6faac_7271_11e5_a85f_04013fc66a01",
                    "stat_tag": "ece6faac-7271-11e5-a85f-04013fc66a01",
                    "params": {
                      "layer0": 1,
                      "layer1": 1
                    },
                    "layers": [
                      {
                        "layer_name": "districtes_barcelona",
                        "interactivity": "cartodb_id,area,c_distri,coord_x,coord_y,dones,homes,n_distri,perim,web_1,web_2,web_3",
                        "visible": true,
                        "infowindow": {
                          "fields": [
                            {
                              "name": "area",
                              "title": true,
                              "position": 0
                            },
                            {
                              "name": "c_distri",
                              "title": true,
                              "position": 1
                            },
                            {
                              "name": "coord_x",
                              "title": true,
                              "position": 2
                            },
                            {
                              "name": "coord_y",
                              "title": true,
                              "position": 3
                            },
                            {
                              "name": "dones",
                              "title": true,
                              "position": 4
                            },
                            {
                              "name": "homes",
                              "title": true,
                              "position": 5
                            },
                            {
                              "name": "n_distri",
                              "title": true,
                              "position": 6
                            },
                            {
                              "name": "perim",
                              "title": true,
                              "position": 7
                            },
                            {
                              "name": "web_1",
                              "title": true,
                              "position": 8
                            },
                            {
                              "name": "web_2",
                              "title": true,
                              "position": 9
                            },
                            {
                              "name": "web_3",
                              "title": true,
                              "position": 10
                            }
                          ],
                          "template_name": "table/views/infowindow_light",
                          "template": "<div class=\"CDB-infowindow CDB-infowindow--dark cartodb-popup\">\n  <div class=\"CDB-infowindow-container\">\n <div class=\"CDB-infowindow-bg\">\n <div class=\"CDB-infowindow-inner\">\n <ul class=\"CDB-infowindow-list\">\n    <li class=\"CDB-infowindow-listItem\">\n      {{#content.fields}}\n        {{#title}}<h5 class='CDB-infowindow-subtitle'>{{title}}</h5>{{/title}}\n  {{#value}}\n  <h4 class=\"CDB-infowindow-title\">{{{ value }}}</h4>\n        {{/value}}\n        {{^value}}\n          <h4 class=\"CDB-infowindow-title\">null</h4>\n        {{/value}}\n      {{/content.fields}}\n    </li>\n  </ul>\n </div>\n </div>\n  <div class=\"CDB-hook\">\n <div class=\"CDB-hook-inner\">\n </div>\n </div>\n </div>\n</div>\n",
                          "alternative_names": {},
                          "width": 226,
                          "maxHeight": 180
                        },
                        "tooltip": {
                          "fields": [
                            {
                              "name": "area",
                              "title": true,
                              "position": 0
                            },
                            {
                              "name": "c_distri",
                              "title": true,
                              "position": 1
                            },
                            {
                              "name": "coord_x",
                              "title": true,
                              "position": 2
                            },
                            {
                              "name": "coord_y",
                              "title": true,
                              "position": 3
                            },
                            {
                              "name": "dones",
                              "title": true,
                              "position": 4
                            },
                            {
                              "name": "homes",
                              "title": true,
                              "position": 5
                            },
                            {
                              "name": "n_distri",
                              "title": true,
                              "position": 6
                            },
                            {
                              "name": "perim",
                              "title": true,
                              "position": 7
                            },
                            {
                              "name": "web_1",
                              "title": true,
                              "position": 8
                            },
                            {
                              "name": "web_2",
                              "title": true,
                              "position": 9
                            },
                            {
                              "name": "web_3",
                              "title": true,
                              "position": 10
                            }
                          ],
                          "template_name": "tooltip_light",
                          "template": "<div class=\"cartodb-tooltip-content-wrapper\">\n  <div class=\"cartodb-tooltip-content\">\n  {{#fields}}\n    {{#title}}\n    <h4>{{title}}</h4>\n    {{/title}}\n    <p>{{{ value }}}</p>\n  {{/fields}}\n  </div>\n</div>",
                          "alternative_names": {},
                          "maxHeight": 180
                        },
                      },
                      {
                        "layer_name": "arboles",
                        "interactivity": "cartodb_id",
                        "visible": true,
                        "infowindow": {
                          "fields": [
                            {
                              "name": "name",
                              "title": true,
                              "position": 0
                            }
                          ],
                          "template_name": "infowindow_light",
                          "template": "<div class=\"CDB-infowindow CDB-infowindow--light cartodb-popup\">\n  <div class=\"CDB-infowindow-container\">\n <div class=\"CDB-infowindow-bg\">\n <div class=\"CDB-infowindow-inner\">\n <ul class=\"CDB-infowindow-list\">\n    <li class=\"CDB-infowindow-listItem\">\n      {{#content.fields}}\n        {{#title}}<h5 class='CDB-infowindow-subtitle'>{{title}}</h5>{{/title}}\n  {{#value}}\n  <h4 class=\"CDB-infowindow-title\">{{{ value }}}</h4>\n        {{/value}}\n        {{^value}}\n          <h4 class=\"CDB-infowindow-title\">null</h4>\n        {{/value}}\n      {{/content.fields}}\n    </li>\n  </ul>\n </div>\n </div>\n  <div class=\"CDB-hook\">\n <div class=\"CDB-hook-inner\">\n </div>\n </div>\n </div>\n</div>\n",
                          "alternative_names": {},
                          "width": 226,
                          "maxHeight": 180
                        },
                      }
                    ]
                  },
                  "attribution": ""
                }
              }, {
                "options": {
                  "visible": true,
                  "type": "Tiled",
                  "name": "Positron Labels",
                  "urlTemplate": "http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png",
                  "attribution": "© <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors © <a href= \"http://cartodb.com/attributions#basemaps\">CartoDB</a>",
                  "minZoom": "0",
                  "maxZoom": "18",
                  "subdomains": "abcd",
                  "kind": "tiled",
                  "order": 4,
                  "id": "2045d4f7-7a76-4b41-8acf-88e32ac49370",
                  "className": "httpsbasemapscartocdncomlight_only_labelszxypng",
                  "parent_id": null
                },
                "infowindow": null,
                "tooltip": null,
                "id": "2045d4f7-7a76-4b41-8acf-88e32ac49370",
                "order": 4,
                "type": "tiled"
              }
            ],
            "overlays": [
              {
                "type": "share",
                "order": 2,
                "options": {
                  "display": true,
                  "x": 20,
                  "y": 20
                },
                "template": ""
              },
              {
                "type": "search",
                "order": 3,
                "options": {
                  "display": true,
                  "x": 60,
                  "y": 20
                },
                "template": ""
              },
              {
                "type": "zoom",
                "order": 6,
                "options": {
                  "display": true,
                  "x": 20,
                  "y": 20
                },
                "template": "<a href=\"#zoom_in\" class=\"zoom_in\">+</a> <a href=\"#zoom_out\" class=\"zoom_out\">-</a>"
              },
              {
                "type": "loader",
                "order": 8,
                "options": {
                  "display": true,
                  "x": 20,
                  "y": 150
                },
                "template": "<div class=\"loader\" original-title=\"\"></div>"
              },
              {
                "type": "logo",
                "order": 9,
                "options": {
                  "display": true,
                  "x": 10,
                  "y": 40
                },
                "template": ""
              }
            ],
            "prev": null,
            "next": null,
            "transition_options": {
              "time": 0
            },
            "datasource": {
              "type": "namedmap",
              "user_name": "pablo",
              "maps_api_template": "https://{user}.cartodb-staging.com:443",
              "template_name": "widgets",
              "stat_tag": "ece6faac-7271-11e5-a85f-04013fc66a01",
              "force_cors": true // This is sometimes set in the editor
            }
          }


          cartodb.createVis('dashboard', vizJSON2, {
            no_cdn: false,
            layer_selector: true,
          })
          .done(function(vis, layers) {
            window.layers = layers.models[1].layers;
            console.log(layers)

          })
          .error(function(err) {
            console.log(err);
          });
      }

    </script>
  </body>
</html>
